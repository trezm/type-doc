<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<title>Hermit Docs - Electron</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
	<style>
		body {
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			padding: 0;
			margin: 0;
			font-family: "Open Sans";
		}
	</style>
</head>
<body>
  <h1>Welcome to them docs playa</h1>
  <input type="file" id="typedoc-import">

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      /**
       * set up handling of file input to POST to server
       */
      (function() {
        var fileInput = document.getElementById('typedoc-import');

        fileInput.addEventListener('change', function(event) {
          var reader = new FileReader();

          reader.onload = function(evt) {
            var fileContents = evt.target.result;
            var request = new Promise(function(resolve, reject) {
              let xhr = new XMLHttpRequest();
              let endpoint = 'http://localhost:3000/validate';

              xhr.open('POST', endpoint, true);
              xhr.setRequestHeader('Content-type', 'application/json');
              xhr.setRequestHeader('Accept', 'application/json');
              xhr.onreadystatechange = function() {
                if (xhr.status === 200 && xhr.readyState === 3) {
                  resolve(JSON.parse(xhr.responseText));
                } else if (xhr.status !== 200 && xhr.readyState === 3) {
                  reject();
                }

                // TODO: handle other error cases
              };
              xhr.send(JSON.stringify({
                input: fileContents
              }));
            });

            request.then(function(data) {
              console.log(data);
            }).catch(function(err) {
              console.error(err);
            });
          };

          reader.readAsText(this.files[0]);
        })
      })();
    });
  </script>
</body>
</html>